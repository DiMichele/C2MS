# ==============================================================================
# SUGECO - Apache Security Configuration
# ==============================================================================
# ISTRUZIONI:
# Questo file contiene configurazioni di sicurezza da applicare ad Apache.
# 
# PER XAMPP:
# 1. Apri: C:\xampp\apache\conf\httpd.conf
# 2. Aggiungi alla fine: Include "C:/xampp/htdocs/SUGECO/config/apache-security.conf"
# 3. Riavvia Apache da XAMPP Control Panel
#
# OPPURE:
# Copia il contenuto di questo file nel tuo httpd.conf principale
# ==============================================================================

# ==============================================================================
# DISABILITA MOD_INFO E MOD_STATUS
# ==============================================================================
# Questi moduli espongono informazioni sensibili sulla configurazione del server

# Disabilita /server-info completamente
<Location /server-info>
    Require all denied
</Location>

# Disabilita /server-status completamente
<Location /server-status>
    Require all denied
</Location>

# Se vuoi mantenere server-status solo per localhost (per debugging):
# <Location /server-status>
#     SetHandler server-status
#     Require local
# </Location>

# ==============================================================================
# DISABILITA CGI SCRIPTS DI TEST
# ==============================================================================
# Rimuove accesso a script CGI pericolosi come printenv.pl

<Directory "/xampp/cgi-bin">
    Options -ExecCGI
    Require all denied
</Directory>

<Directory "C:/xampp/cgi-bin">
    Options -ExecCGI
    Require all denied
</Directory>

# Blocca accesso a qualsiasi file .pl o .cgi
<FilesMatch "\.(pl|cgi)$">
    Require all denied
</FilesMatch>

# ==============================================================================
# DISABILITA DIRECTORY LISTING GLOBALMENTE
# ==============================================================================
<Directory />
    Options -Indexes
</Directory>

<Directory "C:/xampp/htdocs">
    Options -Indexes -ExecCGI -FollowSymLinks
    Options +SymLinksIfOwnerMatch
</Directory>

# ==============================================================================
# PROTEZIONE DA HOST HEADER INJECTION
# ==============================================================================
# Definisci solo i VirtualHost necessari

# Default VirtualHost che rifiuta richieste con Host header sconosciuto
# Metti questo PRIMA degli altri VirtualHost
# <VirtualHost _default_:80>
#     ServerName invalid.host
#     Redirect 403 /
# </VirtualHost>

# ==============================================================================
# NASCONDI INFORMAZIONI SUL SERVER
# ==============================================================================
# Riduce le informazioni esposte negli header di risposta

ServerTokens Prod
ServerSignature Off

# Rimuove header X-Powered-By (se mod_headers è abilitato)
<IfModule mod_headers.c>
    Header unset X-Powered-By
    Header always unset X-Powered-By
    Header unset Server
</IfModule>

# ==============================================================================
# DISABILITA METODI HTTP NON NECESSARI
# ==============================================================================
# TRACE e TRACK possono essere usati per attacchi XST (Cross-Site Tracing)
# Questa è una configurazione CRITICA per la sicurezza

TraceEnable Off

# Blocca anche a livello di rewrite per maggiore sicurezza
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK) [NC]
    RewriteRule .* - [F,L]
</IfModule>

# ==============================================================================
# LIMITI DI SICUREZZA
# ==============================================================================
# Previene alcuni tipi di attacchi DoS

# Timeout per le richieste (secondi)
Timeout 60

# Massimo numero di richieste per connessione keep-alive
MaxKeepAliveRequests 100

# Timeout keep-alive
KeepAliveTimeout 5

# Limita la dimensione degli header delle richieste (byte)
LimitRequestFieldSize 8190

# Limita il numero di header nelle richieste
LimitRequestFields 100

# ==============================================================================
# CONFIGURAZIONE SSL/TLS (se abilitato)
# ==============================================================================
# Decommentare e configurare quando si abilita HTTPS

# <IfModule mod_ssl.c>
#     # Usa solo protocolli moderni e sicuri
#     SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
#     
#     # Cipher suite sicure
#     SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
#     
#     # Preferisci i cipher del server
#     SSLHonorCipherOrder on
#     
#     # Abilita HSTS
#     Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
# </IfModule>

# ==============================================================================
# CONFIGURAZIONE SPECIFICA PER SUGECO
# ==============================================================================

<Directory "C:/xampp/htdocs/SUGECO">
    Options -Indexes -ExecCGI
    AllowOverride All
    Require all granted
</Directory>

# Blocca accesso a directory sensibili di SUGECO
<DirectoryMatch "^C:/xampp/htdocs/SUGECO/(\.git|vendor|node_modules|storage|bootstrap|config|database|resources|routes|tests)">
    Require all denied
</DirectoryMatch>

# ==============================================================================
# LOG DI SICUREZZA
# ==============================================================================
# Configura logging per monitorare tentativi di attacco

# Log degli errori con livello dettagliato
# LogLevel warn

# Log personalizzato per richieste sospette
# SetEnvIf Request_URI "^/server-" suspicious
# SetEnvIf Request_URI "^/cgi-bin" suspicious
# CustomLog "logs/security_access.log" combined env=suspicious
